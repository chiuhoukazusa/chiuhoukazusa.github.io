---
layout: post
title: "æ¯æ—¥ç¼–ç¨‹å®è·µ: Perlin Noise ç¨‹åºåŒ–çº¹ç†ç”Ÿæˆå™¨"
date: 2026-02-17 10:08:00 +0800
categories: [ç¼–ç¨‹å®è·µ, C++, å›¾å½¢å­¦]
tags: [æ¯æ—¥ä¸€ç»ƒ, Perlin Noise, ç¨‹åºåŒ–ç”Ÿæˆ, çº¹ç†, FBM]
---

# Perlin Noise ç¨‹åºåŒ–çº¹ç†ç”Ÿæˆå™¨

ä»Šå¤©å®ç°äº†ä¸€ä¸ªåŸºäº Perlin Noise ç®—æ³•çš„ç¨‹åºåŒ–çº¹ç†ç”Ÿæˆå™¨ï¼Œå¯ä»¥ç”Ÿæˆè‡ªç„¶çš„å¤§ç†çŸ³ã€äº‘æœµå’Œæœ¨çº¹çº¹ç†ã€‚

## é¡¹ç›®ç›®æ ‡

ä½¿ç”¨ç»å…¸çš„ Perlin Noise ç®—æ³•å’Œåˆ†å½¢å¸ƒæœ—è¿åŠ¨ï¼ˆFBMï¼‰æŠ€æœ¯ï¼Œç”Ÿæˆä¸‰ç§ä¸åŒé£æ ¼çš„ç¨‹åºåŒ–çº¹ç†ï¼š
1. æµåŠ¨çš„å¤§ç†çŸ³çº¹ç†
2. è“¬æ¾çš„äº‘æœµçº¹ç†
3. ç¯å½¢çš„æœ¨çº¹çº¹ç†

## å®ç°è¿‡ç¨‹

### è¿­ä»£å†å²

è¿™ä¸ªé¡¹ç›®éå¸¸é¡ºåˆ©ï¼Œ**ä¸€æ¬¡ç¼–è¯‘è¿è¡ŒæˆåŠŸ**ï¼ğŸ‰

1. **è§„åˆ’é˜¶æ®µ (10:01)**: é€‰æ‹© Perlin Noise ä¸»é¢˜ï¼Œè®¾è®¡ä¸‰ç§çº¹ç†ç±»å‹
2. **ç¼–å†™ä»£ç  (10:02)**: å®ç°æ ¸å¿ƒç®—æ³•å’Œä¸‰ç§çº¹ç†ç”Ÿæˆå‡½æ•°
3. **ç¼–è¯‘ (10:04)**: âœ… ç¼–è¯‘æˆåŠŸï¼ˆåªæœ‰æ¥è‡ª stb åº“çš„æ— å®³è­¦å‘Šï¼‰
4. **è¿è¡Œ (10:05)**: âœ… æˆåŠŸç”Ÿæˆ 3 ä¸ª 512x512 PNG æ–‡ä»¶
5. **éªŒè¯ (10:06)**: âœ… æ‰€æœ‰è¾“å‡ºæ ¼å¼æ­£ç¡®ï¼Œçº¹ç†æ•ˆæœç¬¦åˆé¢„æœŸ

## æ ¸å¿ƒä»£ç 

### Perlin Noise ç±»å®ç°

```cpp
class PerlinNoise {
private:
    std::vector<int> permutation;  // æ’åˆ—è¡¨
    
    // æ·¡åŒ–å‡½æ•°ï¼šå¹³æ»‘æ’å€¼
    double fade(double t) {
        return t * t * t * (t * (t * 6 - 15) + 10);
    }
    
    // æ¢¯åº¦æ’å€¼
    double grad(int hash, double x, double y, double z) {
        int h = hash & 15;
        double u = h < 8 ? x : y;
        double v = h < 4 ? y : (h == 12 || h == 14 ? x : z);
        return ((h & 1) == 0 ? u : -u) + ((h & 2) == 0 ? v : -v);
    }
    
public:
    // æ ¸å¿ƒå™ªå£°å‡½æ•°
    double noise(double x, double y, double z);
    
    // åˆ†å½¢å¸ƒæœ—è¿åŠ¨ï¼ˆå¤šå±‚å™ªå£°å åŠ ï¼‰
    double fbm(double x, double y, int octaves, double persistence);
};
```

### åˆ†å½¢å¸ƒæœ—è¿åŠ¨ (FBM)

```cpp
double fbm(double x, double y, int octaves = 6, double persistence = 0.5) {
    double total = 0.0;
    double frequency = 1.0;
    double amplitude = 1.0;
    double maxValue = 0.0;
    
    for (int i = 0; i < octaves; i++) {
        total += noise(x * frequency, y * frequency, 0.0) * amplitude;
        maxValue += amplitude;
        amplitude *= persistence;  // æ¯å±‚è¡°å‡
        frequency *= 2.0;          // é¢‘ç‡åŠ å€
    }
    
    return total / maxValue;
}
```

### ä¸‰ç§çº¹ç†ç”ŸæˆæŠ€å·§

**1. å¤§ç†çŸ³çº¹ç†**
```cpp
double marble = sin((x + noise * 5.0) * M_PI);
```
ä½¿ç”¨æ­£å¼¦æ³¢æ‰°åŠ¨äº§ç”ŸæµåŠ¨æ„Ÿï¼Œç±»ä¼¼å¤§ç†çŸ³çš„æµåŠ¨çº¹è·¯ã€‚

**2. äº‘æœµçº¹ç†**
```cpp
double noiseValue = perlin.fbm(x, y, 8, 0.6);
```
ä½¿ç”¨ 8 å±‚é«˜é¢‘å™ªå£°å åŠ ï¼Œpersistence=0.6ï¼Œæ¨¡æ‹Ÿäº‘å±‚çš„å¤æ‚ç»†èŠ‚ã€‚

**3. æœ¨çº¹çº¹ç†**
```cpp
double distance = sqrt(x * x + y * y);
double wood = sin((distance + noise * 3.0) * M_PI);
```
åŸºäºå¾„å‘è·ç¦»çš„ç¯å½¢å™ªå£°ï¼Œæ¨¡æ‹Ÿæ ‘æœ¨çš„å¹´è½®ç»“æ„ã€‚

## è¿è¡Œç»“æœ

### å¤§ç†çŸ³çº¹ç†
![å¤§ç†çŸ³çº¹ç†]({{ site.baseurl }}/assets/images/02-17-marble.png)

æµåŠ¨çš„ç™½è‰²å¤§ç†çŸ³ï¼Œå¸¦æœ‰ç°è‰²å’Œæµ…è“è‰²çš„çº¹è·¯ï¼Œéå¸¸è‡ªç„¶ã€‚

### äº‘æœµçº¹ç†
![äº‘æœµçº¹ç†]({{ site.baseurl }}/assets/images/02-17-clouds.png)

è“¬æ¾çš„äº‘å±‚æ•ˆæœï¼Œç™½è‰²åˆ°æµ…è“è‰²çš„æ¸å˜ï¼Œå±‚æ¬¡æ„Ÿä¸°å¯Œã€‚

### æœ¨çº¹çº¹ç†
![æœ¨çº¹çº¹ç†]({{ site.baseurl }}/assets/images/02-17-wood.png)

ç¯å½¢çš„æœ¨çº¹ç»“æ„ï¼Œæ·±æµ…ç›¸é—´çš„æ£•è‰²ï¼ŒåƒçœŸå®çš„æ ‘æœ¨æ¨ªåˆ‡é¢ã€‚

## æŠ€æœ¯æ€»ç»“

### Perlin Noise æ ¸å¿ƒåŸç†

1. **æ’åˆ—è¡¨ (Permutation Table)**: 256 ä¸ªéšæœºæ’åˆ—çš„ç´¢å¼•ï¼Œç”¨äºå“ˆå¸Œç©ºé—´åæ ‡
2. **æ·¡åŒ–å‡½æ•° (Fade Function)**: `6tâµ - 15tâ´ + 10tÂ³` ç¡®ä¿å¹³æ»‘è¿‡æ¸¡
3. **æ¢¯åº¦æ’å€¼**: åœ¨å•ä½ç«‹æ–¹ä½“çš„ 8 ä¸ªè§’è¿›è¡Œä¸‰çº¿æ€§æ’å€¼
4. **å‘¨æœŸæ€§**: é€šè¿‡å–æ¨¡è¿ç®—å®ç°æ— ç¼å¹³é“º

### FBM çš„é­”åŠ›

åˆ†å½¢å¸ƒæœ—è¿åŠ¨é€šè¿‡å åŠ ä¸åŒé¢‘ç‡å’ŒæŒ¯å¹…çš„å™ªå£°å±‚ï¼Œäº§ç”Ÿè‡ªç„¶ç•Œå¸¸è§çš„è‡ªç›¸ä¼¼æ€§ï¼š

- **ä½é¢‘å±‚**: æä¾›å¤§å°ºåº¦çš„å½¢çŠ¶
- **é«˜é¢‘å±‚**: æ·»åŠ ç²¾ç»†çš„ç»†èŠ‚
- **Persistence**: æ§åˆ¶é«˜é¢‘å±‚çš„è´¡çŒ®ï¼ˆé€šå¸¸ 0.5ï¼‰
- **Lacunarity**: é¢‘ç‡å¢é•¿ç‡ï¼ˆé€šå¸¸ 2.0ï¼‰

### æ€§èƒ½ä¼˜åŒ–

- **å†…å­˜å ç”¨**: 3 Ã— 512 Ã— 512 Ã— 3 = 2.4 MBï¼ˆåƒç´ æ•°æ®ï¼‰
- **ç”Ÿæˆæ—¶é—´**: ~0.5 ç§’ï¼ˆå•æ ¸ CPUï¼‰
- **æ–‡ä»¶å‹ç¼©**: PNG æ ¼å¼ï¼Œå¤§ç†çŸ³ 353KBï¼Œäº‘æœµ 168KBï¼Œæœ¨çº¹ 317KB

### é‡åˆ°çš„å‘å’Œè§£å†³æ–¹æ¡ˆ

è¿™æ¬¡æ²¡é‡åˆ°ä»€ä¹ˆå‘ï¼ä»£ç ä¸€æ¬¡æˆåŠŸçš„åŸå› ï¼š

1. **ç®—æ³•ç†è§£æ‰å®**: ä¹‹å‰ç ”ç©¶è¿‡ Perlin Noise åŸç†
2. **ä½¿ç”¨æˆç†Ÿåº“**: stb_image_write å•å¤´æ–‡ä»¶ï¼Œé›¶é…ç½®
3. **è¾¹ç•Œå¤„ç†**: ä½¿ç”¨ `& 255` å–æ¨¡ï¼Œé¿å…æ•°ç»„è¶Šç•Œ
4. **å½’ä¸€åŒ–**: å™ªå£°å€¼æ˜ å°„åˆ° [0, 1] å†è½¬æ¢ä¸ºé¢œè‰²

## æ‰©å±•æ–¹å‘

å¯ä»¥ç»§ç»­æ”¹è¿›çš„æ–¹å‘ï¼š

1. **æ›´å¤šçº¹ç†ç±»å‹**: ç«ç„°ã€æ°´æ³¢ã€åœ°å½¢é«˜åº¦å›¾ã€å²©çŸ³
2. **3D å™ªå£°**: ç”Ÿæˆä½“ç§¯çº¹ç†ç”¨äºä½“ç§¯æ¸²æŸ“
3. **Simplex Noise**: Ken Perlin çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œè®¡ç®—æ›´å¿«
4. **GPU åŠ é€Ÿ**: ä½¿ç”¨ CUDA/OpenGL è®¡ç®—ç€è‰²å™¨å¹¶è¡Œç”Ÿæˆ
5. **å®æ—¶é¢„è§ˆ**: æ·»åŠ  GUI ç•Œé¢ï¼Œå®æ—¶è°ƒæ•´å‚æ•°
6. **Worley Noise**: ç»†èƒçº¹ç†ï¼Œé€‚åˆçŸ³å¤´è¡¨é¢
7. **æ··åˆæ¨¡å¼**: å¤šç§å™ªå£°ç±»å‹æ··åˆï¼Œäº§ç”Ÿæ›´å¤æ‚æ•ˆæœ

## ä»£ç ä»“åº“

å®Œæ•´ä»£ç å·²ä¸Šä¼ ï¼š
- **GitHub**: [daily-coding-practice/2026/02/02-17-Perlin-Noise-Texture-Generator](https://github.com/chiuhoukazusa/daily-coding-practice/tree/main/2026/02/02-17-Perlin-Noise-Texture-Generator)

---

**å®Œæˆæ—¶é—´**: 2026-02-17 10:08  
**è¿­ä»£æ¬¡æ•°**: 1 æ¬¡ï¼ˆä¸€æ¬¡æˆåŠŸ âœ…ï¼‰  
**ç¼–è¯‘å™¨**: g++ 12.3.1  
**ä¾èµ–åº“**: stb_image_write.h

## å‚è€ƒèµ„æ–™

- [Ken Perlin's Original Paper (1985)](https://mrl.nyu.edu/~perlin/paper445.pdf)
- [Understanding Perlin Noise](http://adrianb.io/2014/08/09/perlinnoise.html)
- [The Book of Shaders - Noise](https://thebookofshaders.com/11/)
- [GPU Gems - Chapter 5: Implementing Improved Perlin Noise](https://developer.nvidia.com/gpugems/gpugems/part-i-natural-effects/chapter-5-implementing-improved-perlin-noise)
